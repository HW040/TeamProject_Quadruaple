import{l as A,r as l,V as _,R,g as D,j as t,b as V,a as Z,e as G}from"./index-vPyaWLeP.js";import{d as E,a as J,b as Q,m as U,c as X,e as Y,F as ee}from"./match-C6wYgUSM.js";import{K as te,u as K,b as L,c as S,d as se,e as le}from"./MarkerClusterer-ocTskxQJ.js";import{t as q}from"./tripAtom-Cona1Fda.js";import{I as ne}from"./index-D6yxsJgh.js";import{B as ae}from"./button-DbuczX__.js";import{a as re}from"./pic-Bp3CpqNF.js";import{C as oe}from"./TitleHeader-DmOIGpGi.js";import{R as ce}from"./index-BknOe4VR.js";const ie=A.forwardRef(function(I,i){let{position:x,children:d,clickable:N,xAnchor:b,yAnchor:h,zIndex:w,onCreate:f}=I;const c=l.useContext(te),p=K("CustomOverlayMap"),u=l.useMemo(()=>new kakao.maps.LatLng(x.lat,x.lng),[x.lat,x.lng]),n=l.useMemo(()=>{const g=document.createElement("div");return g.style.display="none",new kakao.maps.CustomOverlay({clickable:N,xAnchor:b,yAnchor:h,zIndex:w,position:u,content:g})},[N,b,h]),r=l.useMemo(()=>n.getContent(),[n]);return l.useImperativeHandle(i,()=>n,[n]),l.useLayoutEffect(()=>{if(p)return c?c.addMarker(n,!0):n.setMap(p),()=>{c?c.removeMarker(n,!0):n.setMap(null)}},[p,c,n]),l.useLayoutEffect(()=>{f&&f(n)},[n,f]),L(n,"setPosition",u),L(n,"setZIndex",w),r.parentElement&&_.createPortal(d,r.parentElement)}),xe=A.forwardRef(function(I,i){let{path:x,endArrow:d,onClick:N,onMousedown:b,onMousemove:h,onMouseout:w,onMouseover:f,onCreate:c,strokeColor:p,strokeOpacity:u,strokeStyle:n,strokeWeight:r,zIndex:g}=I;const y=K("Polyline"),C=l.useMemo(()=>x.every(j=>j instanceof Array)?x.map(j=>j.map(m=>new kakao.maps.LatLng(m.lat,m.lng))):x.map(j=>new kakao.maps.LatLng(j.lat,j.lng)),[x]),a=l.useMemo(()=>new kakao.maps.Polyline({path:C,endArrow:d,strokeColor:p,strokeOpacity:u,strokeStyle:n,strokeWeight:r,zIndex:g}),[]);return l.useImperativeHandle(i,()=>a,[a]),l.useLayoutEffect(()=>(a.setMap(y),()=>a.setMap(null)),[y,a]),l.useLayoutEffect(()=>{c&&c(a)},[a,c]),l.useLayoutEffect(()=>{a.setOptions({endArrow:d,strokeColor:p,strokeOpacity:u,strokeStyle:n,strokeWeight:r})},[a,d,p,u,n,r]),L(a,"setPath",C),L(a,"setZIndex",g),S(a,"mouseover",f),S(a,"mouseout",w),S(a,"mousemove",h),S(a,"mousedown",b),S(a,"click",N),null}),pe=({setMemoModal:s,tripId:I,data:i,getTrip:x,setTripData:d})=>{const[N,b]=R(q),h=D("accessToken"),[w,f]=l.useState(""),c=()=>{s(!1)},p=r=>{r.stopPropagation()},u=r=>{f(r.target.value)},n=async r=>{var C;const g=((C=i==null?void 0:i.schedules)==null?void 0:C.length)>0?i.schedules[i.schedules.length-1].seq:0,y={trip_id:N.nowTripId,day:i.day,seq:g+1,content:r};console.log("메모 데이터",y);try{(await V.post("/api/memo/post",y,{headers:{Authorization:`Bearer ${h}`}})).data.code==="200 성공"&&x()}catch(a){console.log("메모 추가",a)}};return t.jsx("div",{className:`fixed top-0 left-[50%] translate-x-[-50%] z-10\r
                max-w-3xl w-full mx-auto h-full\r
                flex items-center justify-center\r
                bg-[rgba(0,0,0,0.5)]`,onClick:()=>{c()},children:t.jsxs("div",{className:`bg-white w-[630px] \r
                    rounded-2xl px-[60px] py-[55px]\r
                    flex items-center justify-center`,onClick:p,children:[t.jsx(ne,{placeholder:"메모를 입력해주세요.",variant:"borderless",allowClear:!0,onChange:r=>{u(r)}}),t.jsx(ae,{type:"Outline",onClick:()=>{n(w),s(!1)},className:"text-slate-600",children:"확인"})]})})},ke=({data:s,showMap:I=!0,newTrip:i=!1,startAt:x,tripId:d,getTrip:N,setTripData:b,index:h,date:w,readOnly:f=!1})=>{const[c,p]=R(q);D("accessToken"),l.useEffect(()=>{},[c]);const u=Z(),n=()=>{u(`/search/trip?tripId=${d}`),console.log(s)},[r,g]=l.useState(!1);l.useState({lat:35.868475,lng:128.593743}),l.useState();const[y,C]=l.useState(!1),[a,j]=l.useState(!1);l.useEffect(()=>{},[y]);const m=(s==null?void 0:s.schedules)||[],v=m.filter(e=>e.scheOrMemo==="SCHE"),T=v==null?void 0:v.map((e,o)=>({title:e.strfTitle,latlng:{lat:e.lat,lng:e.lng}})),z=[T.map(e=>e.latlng)],B=e=>{if(!e.length)return{lat:37.5665,lng:126.978};const o=e.filter(k=>k.latlng&&parseFloat(k.latlng.lat)!=null&&k.latlng.lng!=null);if(!o.length)return{lat:37.5665,lng:126.978};const M=o.reduce((k,P)=>(k.lat+=parseFloat(P.latlng.lat),k.lng+=parseFloat(P.latlng.lng),k),{lat:0,lng:0});return{lat:M.lat/o.length,lng:M.lng/o.length}},$=m.filter(e=>e.distance!==null).map(e=>e.distance),O=$.length>0?$.reduce((e,o)=>e+o,0)/$.length:0;console.log("평균 거리:",O);const F=e=>e>2e4?10:e>1e4?9:e>5e3?8:5;if(l.useEffect(()=>{const e=document.createElement("script");return e.async=!0,e.src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1227efa5c91b2ace09ab915e643a15c9&autoload=false",e.addEventListener("load",()=>{window.kakao.maps.load(()=>{g(!0)})}),document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),!r)return t.jsx("div",{children:"지도를 불러오는 중입니다..."});const H=()=>{var M;const e=v[v.length-1],o=((M=m[m.length-1])==null?void 0:M.seq)||0;console.log("lastSche",e),console.log("lastSeq",o),p({...c,lastSeq:o,nowTripId:d,day:s.day,prevScheName:v.length>0?e.strfTitle:"",prevSchelat:v.length>0?e.lat:"",prevSchelng:v.length>0?e.lng:""}),n()},W=e=>{console.log(e),u(`/contents/index?strfId=${e.strfId}`)};return t.jsxs("div",{className:"flex flex-col gap-[30px]",children:[t.jsx("div",{className:"h-[10px] bg-slate-100"}),I?t.jsx("div",{className:"h-[292px] px-[32px]",children:t.jsxs(se,{center:B(T),style:{width:"100%",height:"100%",borderRadius:"8px"},level:F(O),children:[T.map((e,o)=>t.jsx(ie,{position:e.latlng,children:t.jsxs("div",{className:`label text-white w-[20px] h-[20px]
                  flex items-center justify-center rounded-full
                  
                  ${E(s==null?void 0:s.day)}`,children:[t.jsx("span",{className:"center font-medium text-white text-[12px]",children:o+1})," "]})},`${e.title}-${o}`)),t.jsx(xe,{path:z,strokeWeight:3,strokeColor:J(s==null?void 0:s.day),strokeOpacity:.7,strokeStyle:"solid"})]})}):null,t.jsxs("div",{className:"flex flex-col gap-[20px] px-[32px]",children:[t.jsxs("div",{className:"flex gap-[10px] items-center",children:[t.jsxs("h3",{className:`font-work-sans text-[24px] font-bold ${Q(s.day||h+1)} `,children:["Day ",s.day||h+1]}),t.jsx("span",{className:"text-[18px] text-slate-700",children:w}),t.jsx("div",{className:"w-[30px] h-[30px] flex items-center justify-center text-[30px]",children:U(s==null?void 0:s.weather)})]}),t.jsxs("ul",{className:"relative flex flex-col gap-[30px]",children:[m==null?void 0:m.map((e,o)=>{const M=v.findIndex(k=>k.scheduleMemoId===e.scheduleMemoId);return t.jsxs("li",{className:"flex flex-col gap-[30px] justify-center ",children:[e.scheOrMemo==="SCHE"?t.jsxs("div",{className:"flex gap-[30px] items-center cursor-pointer",onClick:()=>{W(e)},children:[t.jsx("div",{className:`w-[30px] h-[30px]
                                  flex items-center justify-center  
                                  rounded-full
                                  text-[16px] text-white font-medium
                                  ${E(s==null?void 0:s.day)}`,children:M!==-1?M+1:"없음"}),t.jsxs("div",{className:"flex gap-[20px] items-center",children:[t.jsx("div",{className:"w-[60px] h-[60px] bg-slate-200 rounded-lg overflow-hidden",children:t.jsx("img",{src:`${re}${e.strfId}/${e.picName}`,alt:"thum",className:"w-full h-full object-cover"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-[20px] text-slate-700",children:e.strfTitle}),t.jsxs("div",{className:"flex gap-[10px] items-center",children:[t.jsx("p",{className:"text-[14px] text-slate-500",children:X(e.category)}),t.jsx("div",{className:"flex gap-[10px] items-center",children:t.jsx("div",{className:"flex gap-[5px] items-center",children:t.jsx(ce,{disabled:!0,count:1,value:e.reviewed?1:0,style:{width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center"}})})})]})]})]})]}):f?null:t.jsxs("div",{className:"flex gap-[30px] items-center",children:[t.jsx("div",{className:"w-[30px] h-[30px] flex items-center justify-center",children:t.jsx("div",{className:`w-[10px] h-[10px] flex items-center justify-center rounded-full  text-[16px] text-white font-medium ${E(s==null?void 0:s.day)}`})}),t.jsxs("div",{className:`flex  gap-[10px] justify-between\r
                  px-[40px] py-[20px] w-full rounded-2xl\r
                  bg-slate-50 `,children:[t.jsxs("div",{className:"flex flex-col gap-[10px]",children:[t.jsxs("p",{className:"flex gap-[5px] text-slate-700",children:[t.jsx(G,{className:"text-slate-300 text-[18px]"}),e.title]}),t.jsx("p",{className:"text-[14px]",children:e.content})]}),t.jsx("button",{type:"button",onClick:()=>j(!0),children:t.jsx(oe,{className:"text-slate-300 text-[30px]"})})]})]}),e.scheOrMemo==="SCHE"?t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-[30px] h-[30px] flex items-center justify-center",children:t.jsx("div",{className:`w-[10px] h-[10px] flex items-center justify-center rounded-full  text-[16px] text-white font-medium ${E(s==null?void 0:s.day)}`})}),t.jsxs("div",{className:`${e.pathType===null?"h-[38px] flex gap-[10px] items-center px-[10px] bg-slate-50 rounded-2xl cursor-pointer":"h-[38px] flex gap-[10px] items-center px-[10px] bg-white rounded-2xl"}`,onClick:()=>{console.log(e)},children:[t.jsx("div",{className:`${e.pathType===null?"text-slate-600 h-[18px]":"text-slate-400 h-[18px]"}`,children:Y(e.pathType)}),t.jsxs("div",{className:`${e.pathType===null?"text-[14px] text-slate-600 h-[18px]":"text-[14px] text-slate-400 h-[18px]"}`,children:[e.duration,e.pathType>0?"분":""]})]})]}):null]},o)}),t.jsx("div",{className:`border-l border-slate-200\r
                                absolute left-[14px] top-1/2 -translate-y-1/2\r
                                h-[90%] -z-10`})]}),i?t.jsxs("div",{className:"flex gap-[20px] items-center",children:[t.jsxs("button",{type:"button",className:`flex items-center justify-center gap-[10px]\r
              py-[10px] rounded-lg\r
              w-full\r
              border border-slate-300\r
              text-slate-700 text-[22px] font-medium`,onClick:H,children:[t.jsx(ee,{className:"text-slate-400 text-[18px]"}),"일정 추가"]}),t.jsxs("button",{type:"button",className:`flex items-center justify-center gap-[10px]\r
              py-[10px] rounded-lg\r
              w-full\r
              border border-slate-300\r
              text-slate-700 text-[22px] font-medium`,onClick:()=>{C(!0)},children:[t.jsx(le,{className:"text-slate-400 text-[18px]"}),"메모 추가"]})]}):null]}),y?t.jsx(pe,{setMemoModal:C,tripId:d,data:s,getTrip:N,setTripData:b}):null]})};export{ke as S};
